<template>
  <form @submit.prevent="submit"
        v-form="patientForm"
        class="borderRadius25 marginRightAuto marginLeftAuto displayFlex
               bgWhisper">

    <div class="flex1 padding30">

      <!-- Name field -->
      <div class="marginBottom30 widthTwelve">

        <div class="marginBottom10">
          <label for="name" class="colorMidGray fontSize14">
            Your name
          </label>
        </div>

        <input id="name"
               type="text"
               class="inputText widthTwelve"
               v-model="patientData.name"
               pattern="[A-Za-z\s'\-]+"
               minlength="3"
               required>

        <div v-if="patientForm.state.wasSubmitted"
             class="marginTop12 widthTwelve colorRed fontSize14">
          <div v-if="patientForm.state.fields.name.valueMissing">
            Name is required.
          </div>
          <div v-else-if="patientForm.state.fields.name.tooShort">
            Please enter your first and last name.
          </div>
          <div v-else-if="patientForm.state.fields.name.patternMismatch">
            Please use only letters, spaces, dashes, and apostrophes.
          </div>
        </div>

      </div>

      <!-- Sex field -->
      <div class="marginBottom30 widthTwelve">

        <div class="marginBottom10">
          <label for="email" class="colorMidGray fontSize14">
            Your sex
          </label>
        </div>

        <div class="displayFlex lineHeight32 colorDarkGray">

          <label class="marginRight30 cursorPointer displayFlex itemsCenter">
            <input name="sex"
                   type="radio"
                   v-model="patientData.sex"
                   value="female"
                   class="marginRight10">
              <span class="paddingTop5">Female</span>
          </label>

          <label class="cursorPointer displayFlex itemsCenter">
            <input name="sex"
                   type="radio"
                   v-model="patientData.sex"
                   value="male"
                   class="marginRight10">
             <span class="paddingTop5">Male</span>
          </label>

        </div>

        <div v-if="patientForm.state.wasSubmitted"
             class="marginTop12 widthTwelve colorRed fontSize14">
          <div v-if="patientForm.get('sex').valueMissing">
            Sex is required.
          </div>
        </div>

      </div>

      <!-- Pregnant field -->
      <div v-if="patientData.sex === 'female'"
           class="marginBottom30 widthTwelve">

        <div class="marginBottom10">
          <label for="email" class="colorMidGray fontSize14">
            Are you pregnant?
          </label>
        </div>

        <div class="displayFlex lineHeight32 colorDarkGray">

          <label class="marginRight30 cursorPointer displayFlex itemsCenter">
            <input name="pregnant"
                   type="radio"
                   v-model="patientData.pregnant"
                   value="yes"
                   class="marginRight10">
              <span class="paddingTop5">Yes</span>
          </label>

          <label class="cursorPointer displayFlex itemsCenter">
            <input name="pregnant"
                   type="radio"
                   v-model="patientData.pregnant"
                   value="no"
                   class="marginRight10">
             <span class="paddingTop5">No</span>
          </label>

        </div>

        <div v-if="patientForm.state.wasSubmitted"
             class="marginTop12 widthTwelve colorRed fontSize14">
          <div v-if="patientForm.get('pregnant').valueMissing">
            Please specify whether you are pregnant or not.
          </div>
        </div>

      </div>

      <!-- Date of birth field -->
      <div class="marginBottom30 widthTwelve">

        <div class="marginBottom10">
          <label for="dob" class="colorMidGray fontSize14">
            Your date of birth
          </label>
        </div>

        <input id="dob"
               type="date"
               class="inputText widthTwelve"
               v-model="patientData.dob"
               required>

        <div v-if="patientForm.state.wasSubmitted"
             class="marginTop12 widthTwelve colorRed fontSize14">
          <div v-if="patientForm.state.fields.dob.valueMissing">
            Date of birth is required.
          </div>
        </div>

      </div>

    </div>

    <div class="flex1 padding30">

      <!-- Date of birth field -->
      <div v-if="patientData.sex === 'female'"
           class="marginBottom30 widthTwelve">

        <div class="marginBottom10">
          <label for="maritalStatus" class="colorMidGray fontSize14">
            Your marital status
          </label>
        </div>

        <select id="maritalStatus"
                v-model="patientData.maritalStatus"
                class="select widthTwelve"
                required>
          <option :value="undefined" disabled>Please choose one</option>
          <option>Single</option>
          <option>Married</option>
          <option>Other</option>
        </select>

        <div v-if="patientForm.state.wasSubmitted"
             class="marginTop12 widthTwelve colorRed fontSize14">
          <div v-if="patientForm.get('maritalStatus').valueMissing">
            Marital status is required.
          </div>
        </div>

      </div>

      <!-- Reason field -->
      <div class="marginBottom30">

        <div class="marginBottom10">
          <label for="description" class="colorMidGray fontSize14">
            The reason for your visit
          </label>
        </div>

        <div class="paddingBottom10 paddingTop10">
          <label class="colorDarkGray marginRight20 cursorPointer">
            <input name="reasons"
                   type="checkbox"
                   v-model="patientData.reasons"
                   value="checkup"
                   class="marginRight10">
              Checkup
          </label>
        </div>

        <div class="paddingBottom10 paddingTop10">
          <label class="colorDarkGray marginRight20 cursorPointer">
            <input name="reasons"
                   type="checkbox"
                   v-model="patientData.reasons"
                   value="illness"
                   class="marginRight10">
              Illness
          </label>
        </div>

        <div class="paddingBottom10 paddingTop10">
          <label class="colorDarkGray marginRight20 cursorPointer">
            <input name="reasons"
                   type="checkbox"
                   v-model="patientData.reasons"
                   value="pregnancy"
                   class="marginRight10">
              Pregnancy
          </label>
        </div>

        <div class="paddingBottom10 paddingTop10">
          <label class="colorDarkGray marginRight20 cursorPointer">
            <input name="reasons"
                   type="checkbox"
                   v-model="patientData.reasons"
                   value="consultation"
                   class="marginRight10">
              Consultation
          </label>
        </div>

        <div>
          <div class="paddingBottom10 paddingTop10 displayFlex itemsCenter">
              <div class="width30">
                <input name="reasons"
                       type="checkbox"
                       v-model="patientData.reasons"
                       value="other"
                       class="floatLeft">
              </div>
              <input id="otherReason"
                     type="text"
                     placeholder="Other"
                     v-model="patientData.otherReason"
                     class="inputText widthTwelve"
                     :required="otherReasonRequired">
          </div>
        </div>

        <div v-if="patientForm.state.wasSubmitted"
             class="marginTop12 widthTwelve colorRed fontSize14">
          <div v-if="patientForm.get('reasons').valueMissing">
            Reason is required.
          </div>
          <div v-else-if="otherReasonRequired &&
                          patientForm.state.fields.otherReason.valueMissing">
            Please specify the other reason for your visit.
          </div>
        </div>

      </div>

      <!-- Success message -->
      <transition name="fade">
        <div v-if="formSent" class="colorOlive fontSize18 textCenter">
          Patient submitted.
        </div>
      </transition>

      <!-- Form buttons -->
      <div v-if="!formSent" class="textRight fontSize20">

        <!-- Hidden input to test ignoredFields option -->
        <input id="g-captcha-response" type="text" class="displayNone" required>

        <!-- Reset button -->
        <button type="reset"
                class="button circular width140 height50 marginRight30 bgGray">
          <span class="verticalMiddle">Reset</span>
          <reset-icon></reset-icon>
        </button>

        <!-- Submit button -->
        <button type="submit"
                class="button circular width150 height50"
                :class="{ 'disabled': patientForm.state.isInvalid }">
          <span class="verticalMiddle">Submit</span>
          <check-icon></check-icon>
        </button>

      </div>

    </div>

  </form>
</template>

<script>
  import ResetIcon from './ResetIcon'
  import CheckIcon from './CheckIcon'

  let requiredGroups = ['sex', 'reasons']

  export default {
    name: 'PatientForm',
    components: { ResetIcon, CheckIcon },
    data () {
      return {
        formSent: false,
        patientData: { reasons: [], sex: null, pregnant: null },
        patientForm: this.$newVueForm({
          ignoredFields: ['g-captcha-response'],
          requiredGroups
        })
      }
    },
    computed: {
      otherReasonRequired () {
        const { reasons } = this.patientData
        return reasons.indexOf('other') !== -1
      }
    },
    watch: {
      'patientData.sex': function (sex) {
        if (sex === 'female' && !requiredGroups.includes('pregnant')) {
          requiredGroups.push('pregnant')
        } else if (requiredGroups.includes('pregnant')) {
          requiredGroups.splice(requiredGroups.indexOf('pregnant'), 1)
        }
        this.patientForm.updateOptions({ requiredGroups })
      }
    },
    methods: {
      submit () {
        if (this.patientForm.state.isValid) {
          this.formSent = true
          console.log('VALID')
        } else {
          console.log('INVALID')
        }
      }
    }
  }
</script>
